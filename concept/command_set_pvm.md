## Набор команд виртуальной машины python 
набор команд виртуальной машины "python"(eng: command set python virtual machines)

## Примеры

- STOP_CODE 

Указывает компилятору конец кода, не используемый интерпретатором. 

- POP_TOP 

Удаляет элемент вершины стека (TOS). 

- ROT_TWO 

Меняет местами два самых верхних элемента стека. 

- ROT_THREE 

Поднимает второй и третий элементы стека на одну позицию вверх, перемещает верхнюю часть вниз на третью позицию. 

- ROT_FOUR 

Поднимает второй, третий и четвертый элемент стека на одну позицию вверх, перемещает верхнюю часть вниз на четвертую позицию. 

- DUP_TOP 

Дублирует ссылку поверх стека. 


Унарные операции занимают вершину стека, применяют операцию и помещают результат обратно в стек. 

- UNARY_POSITIVE 

Реализует TOS = +TOS. 

- UNARY_NEGATIVE 

Реализует TOS = -TOS. 

- UNARY_NOT 

Реализует TOS = not TOS. 

- UNARY_CONVERT 

Реализует TOS = `TOS`. 

- UNARY_INVERT 

Реализует TOS = ~TOS. 


Двоичные операции удаляют вершину стека (TOS) и второй самый верхний элемент стека (TOS1) из стека. Они выполняют операцию и помещают результат обратно в стек. 

- BINARY_POWER 

Реализует TOS = TOS1 ** TOS. 

- BINARY_MULTIPLY 

Реализует TOS = TOS1 * TOS. 

- BINARY_DIVIDE 

Реализует TOS = TOS1 / TOS. 

- BINARY_MODULO 

Реализует TOS = TOS1 % TOS. 

- BINARY_ADD 

Реализует TOS = TOS1 + TOS. 

- BINARY_SUBTRACT 

Реализует TOS = TOS1 - TOS. 

- BINARY_SUBSCR 

Реализует TOS = TOS1[TOS]. 

- BINARY_LSHIFT 

Реализует TOS = TOS1 << TOS. 

- BINARY_RSHIFT 

Реализует TOS = TOS1 >> TOS. 

- BINARY_XOR 

Реализует TOS = TOS1 ^ TOS. 

- BINARY_ИЛИ 

Реализует TOS = TOS1 | TOS. 


Операции на месте аналогичны бинарным операциям в том смысле, что они удаляют TOS и TOS1 и помещают результат обратно в стек, но операция выполняется на месте, когда TOS1 ее поддерживает, и результирующий TOS может быть (но не иметь быть) оригинальный TOS1. 

- INPLACE_POWER 

Реализует на месте TOS = TOS1 ** TOS. 

- INPLACE_MULTIPLY 

Реализует на месте TOS = TOS1 * TOS. 

- INPLACE_DIVIDE 

Реализует на месте TOS = TOS1 / TOS. 

- INPLACE_MODULO 

Реализует на месте TOS = TOS1 % TOS. 

- INPLACE_ADD 

Реализует на месте TOS = TOS1 + TOS. 

- INPLACE_SUBTRACT 

Реализует на месте TOS = TOS1 - TOS. 

- INPLACE_LSHIFT 

Реализует на месте TOS = TOS1 << TOS. 

- INPLACE_RSHIFT 

Реализует на месте TOS = TOS1 >> TOS. 

- INPLACE_AND 

Реализует на месте TOS = TOS1 & TOS. 

- INPLACE_XOR 

Реализует на месте TOS = TOS1 ^ TOS. 

- INPLACE_ИЛИ 

Реализует на месте TOS = TOS1 | TOS. 


Коды операций среза принимают до трех параметров. 

- РАЗДЕЛ+0 

Реализует TOS = TOS[:]. 

- РАЗДЕЛ+1 

Реализует TOS = TOS1[TOS:]. 

- РАЗДЕЛ+2 

Реализует TOS = TOS1[:TOS1]. 

- РАЗДЕЛ+3 

Реализует TOS = TOS2[TOS1:TOS]. 


Назначение среза требует даже дополнительного параметра. Как и любой оператор, они ничего не помещают в стек. 

- STORE_SLICE+0 

Реализует TOS[:] = TOS1. 

- STORE_SLICE+1 

Реализует TOS1[TOS:] = TOS2. 

- STORE_SLICE+2 

Реализует TOS1[:TOS] = TOS2. 

- STORE_SLICE+3 

Реализует TOS2[TOS1:TOS] = TOS3. 

- DELETE_SLICE+0 

Реализует del TOS[:]. 

- DELETE_SLICE+1 

Реализует del TOS1[TOS:]. 

- DELETE_SLICE+2 

Реализует del TOS1[:TOS]. 

- DELETE_SLICE+3 

Реализует del TOS2[TOS1:TOS]. 

- STORE_SUBSCR 

Реализует TOS1[TOS] = TOS2. 

- DELETE_SUBSCR 

Реализует del TOS1[TOS]. 

- PRINT_EXPR 

Реализует оператор выражения для интерактивного режима. TOS удаляется из стека и печатается. В неинтерактивном режиме оператор выражения завершается с помощью POP_STACK. 

- PRINT_ITEM 

Выводит TOS в файлоподобный объект, привязанный к sys.stdout. Для каждого элемента в операторе печати имеется одна такая инструкция . 

- PRINT_ITEM_TO 

Подобно PRINT_ITEM, но печатает элемент, второй из TOS, в файлоподобный объект в TOS. Это используется расширенным оператором печати. 

- PRINT_NEWLINE 

Печатает новую строку в sys.stdout. Это генерируется как последняя операция оператора печати , если оператор не заканчивается запятой. 

- PRINT_NEWLINE_TO 

Аналогично PRINT_NEWLINE, но печатает новую строку в файлоподобном объекте в TOS. Это используется расширенным оператором печати. 

- BREAK_LOOP 

Завершает цикл из-за оператора break . 

- LOAD_LOCALS 

Помещает ссылку на локальные переменные текущей области в стек. Это используется в коде для определения класса: после оценки тела класса локальные переменные передаются в определение класса. 

- RETURN_VALUE 

Возвращается с TOS вызывающей стороне функции. 

- IMPORT_STAR 

Загружает все символы, не начинающиеся с " _ ", непосредственно из модуля TOS в локальное пространство имен. Модуль всплывает после загрузки всех имен. Этот опкод реализует from module import *. 

- EXEC_STMT 

Реализует exec TOS2,TOS1,TOS. Компилятор заполняет отсутствующие необязательные параметры с помощью None. 

- POP_BLOCK 

Удаляет один блок из стека блоков. Для каждого кадра есть стек блоков, обозначающий вложенные циклы, операторы try и тому подобное. 

- END_FINALLY 

Завершает предложение finally . Интерпретатор вспоминает, нужно ли повторно вызывать исключение или функция возвращается, и продолжает работу с блоком external-next. 

- BUILD_CLASS 

Создает новый объект класса. TOS — это словарь методов, TOS1 — кортеж имен базовых классов, а TOS2 — имя класса. 

Все следующие коды операций ожидают аргументы. Аргумент состоит из двух байтов, причем старший байт последним. 

    Название STORE_NAME 

Реализует name = TOS. namei — индекс имени в атрибуте co_names объекта кода. Компилятор пытается использовать STORE_LOCALили STORE_GLOBAL , если это возможно. 

    Имя DELETE_NAME 

Implements del name, где namei — это индекс атрибута co_names объекта кода. 

    Количество UNPACK_SEQUENCE 

Распаковывает TOS в число отдельных значений, которые помещаются в стек справа налево. 

    Количество DUP_TOPX 

Дублируйте элементы счета , сохраняя их в том же порядке. Из-за ограничений реализации количество должно быть от 1 до 5 включительно. 

    Имя STORE_ATTR 

Implements TOS.name = TOS1, где namei — индекс имени в co_names . 

DELETE_ATTR     имя 

Реализует del TOS.name, используя namei в качестве индекса в co_names . 

    Имя STORE_GLOBAL 

Работает как STORE_NAME, но сохраняет имя как глобальное. 

DELETE_GLOBAL     имя 

Работает как DELETE_NAME, но удаляет глобальное имя. 

LOAD_CONST     постоянно 

Помещает " co_consts[consti ] " в стек. 

    Имя LOAD_NAME 

Помещает значение, связанное с " co_names[ namei ] ", в стек. 

    Количество BUILD_TUPLE 

Создает кортеж, потребляющий количество элементов из стека, и помещает полученный кортеж в стек. 

    Количество BUILD_LIST 

Работает как BUILD_TUPLE, но создает список. 

BUILD_MAP     ноль 

Помещает в стек новый пустой объект словаря. Аргумент игнорируется и устанавливается компилятором в ноль. 

    Имя LOAD_ATTR 

Заменяет TOS на . getattr(TOS, co_names[namei] 

COMPARE_OP     имя оператора 

Выполняет логическую операцию. Имя операции можно найти в . cmp_op[opname] 

    Имя IMPORT_NAME 

Импортирует модуль . Объект модуля помещается в стек. Текущее пространство имен не затрагивается: для правильного оператора импорта последующая инструкция изменяет пространство имен. co_names[namei]STORE_FAST 

IMPORT_FROM     имя 

Загружает атрибут из модуля, найденного в TOS. Полученный объект помещается в стек для последующего сохранения инструкцией. co_names[namei]STORE_FAST 

    Дельта JUMP_FORWARD 

Увеличивает счетчик байт-кода на дельту . 

    Дельта JUMP_IF_TRUE 

Если TOS истинно, увеличьте счетчик байт-кода на дельту . TOS остается в стеке. 

    Дельта JUMP_IF_FALSE 

Если TOS ложно, увеличьте счетчик байт-кода на delta . ТОС не изменен. 

JUMP_ABSOLUTE     цель 

Установите счетчик байт-кода на целевой . 

    Дельта FOR_LOOP 

Перебрать последовательность. TOS — текущий индекс, TOS1 — последовательность. Сначала вычисляется следующий элемент. Если последовательность исчерпана, увеличьте счетчик байт-кода на дельту . В противном случае поместите последовательность, увеличенный счетчик и текущий элемент в стек. 

LOAD_GLOBAL     имя 

Загружает глобальное имя в стек. co_names[namei] 

    Дельта SETUP_LOOP 

Помещает блок для цикла в стек блоков. Блок начинается с текущей инструкции размером в дельта - байты. 

- SETUP_EXCEPT     дельта 

Помещает блок try из предложения try-except в стек блоков. delta указывает на первый блок кроме блока. 

- SETUP_FINALLY     дельта 

Помещает блок try из предложения try-except в стек блоков. delta указывает на блок finally. 

- LOAD_FAST     var_num 

Помещает ссылку на локальный объект в стек. co_varnames[var_num] 

- STORE_FAST     var_num 

Сохраняет TOS в локальном файле . co_varnames[var_num] 

- DELETE_FAST     var_num 

Удаляет локальный . co_varnames[var_num] 

- SET_LINENO     линейно нет 

Устанавливает номер текущей строки в lineno . 

- RAISE_VARARGS     аргумент 

Вызывает исключение. argc указывает количество параметров оператора повышения в диапазоне от 0 до 3. Обработчик найдет трассировку как TOS2, параметр как TOS1 и исключение как TOS. 

- CALL_FUNCTION     аргумент 

Вызывает функцию. Младший байт argc указывает количество позиционных параметров, старший байт — количество параметров ключевого слова. В стеке код операции сначала находит параметры ключевого слова. Для каждого аргумента ключевого слова значение находится поверх ключа. Под параметрами ключевого слова в стеке находятся позиционные параметры, причем крайний правый параметр находится вверху. Под параметрами в стеке находится вызываемый объект функции. 

- MAKE_FUNCTION     аргумент 

Помещает новый объект функции в стек. TOS — это код, связанный с функцией. Объект функции имеет параметры по умолчанию argc , которые находятся ниже TOS. 

- BUILD_SLICE     аргумент 

Помещает объект среза в стек. argc должен быть равен 2 или 3. Если он равен 2, slice(TOS1, TOS)вводится; если это 3, slice(TOS2, TOS1, TOS)нажимается. См. slice()встроенную функцию для получения дополнительной информации. 

- EXTENDED_ARG     доб . 

Префикс любого кода операции, аргумент которого слишком велик, чтобы уместиться в два байта по умолчанию. ext содержит два дополнительных байта, которые вместе с последующим аргументом кода операции составляют четырехбайтовый аргумент, причем ext является двумя старшими байтами. 

- CALL_FUNCTION_VAR     аргумент 

Вызывает функцию. argc интерпретируется как CALL_FUNCTION. Верхний элемент стека содержит список переменных аргументов, за которыми следуют ключевые слова и позиционные аргументы. 

- CALL_FUNCTION_KW     аргумент 

Вызывает функцию. argc интерпретируется как CALL_FUNCTION. Верхний элемент стека содержит словарь аргументов ключевого слова, за которым следуют явные аргументы ключевого слова и позиционные аргументы. 

- CALL_FUNCTION_VAR_KW     аргумент 

Вызывает функцию. argc интерпретируется как CALL_FUNCTION. Верхний элемент в стеке содержит словарь аргументов ключевого слова, за которым следует кортеж переменных аргументов, за которым следуют явные аргументы ключевого слова и позиционные аргументы. 

## Связь с другими машинами
[PVM](python_virtual_machine.md)
